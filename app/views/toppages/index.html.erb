<% if logged_in? %>
  <div class="center jumbotron">
    <div class="text-center">
      <h1>Cafe Navi</h1>
    </div>
  </div>
  <div class="row">
    <aside class="col-sm-4">
      <%= form_with(model: @cafepost, local: true) do |f| %>
        <div class="form-group">
          <%= f.label :店名 %>
          <%= f.text_field :name, class: 'form-control', rows: 1 %>
          <%= f.label :都道府県 %>
          <%= f.select :prefecture, Cafepost.prefectures.keys, {} %>
          <%= f.label :感想 %>
          <%= f.text_area :content, class: 'form-control', rows: 5 %>
          <%= f.label :画像 %>
          <%= f.file_field :image %>
        </div>
        <%= f.submit 'Post', class: 'btn btn-primary btn-block' %>
      <% end %>
      <p>検索</p>
      <%= form_with url: search_cafeposts_path, method: :get, local: true do |f| %>
        <%= f.text_field :name, placeholder: "カフェ名を入力" %>
        <%= f.submit "検索" %>
      <% end %>
    </aside>
    <div class="col-sm-8">
      <% @all_ranks.each.with_index(1) do |cafepost, i| %>
        <li class="media mb-3">
          <img class="mr-2 rounded" src="<%= gravatar_url(cafepost.user, { size: 50 }) %>" alt="">
          <div class="media-body">
            <div>
              <%= "人気ランキング　第#{i}位" %>
            </div>
            <div>
              <%= link_to cafepost.user.name, user_path(cafepost.user) %> <span class="text-muted">posted at <%= cafepost.created_at %></span>
            </div>
            <div>
              <p>店名： <%= link_to cafepost.name, cafepost_path(cafepost) %></p>
              <p>都道府県： <%= cafepost.prefecture %></p>
              <p>感想： <%= cafepost.content %></p>
              <p><%= image_tag cafepost.image.url if cafepost.image? %></p>
            </div>
            <div class='btn-group'>
              <%= render "favorites/favorite_button", cafepost: cafepost %>
              <% if current_user == cafepost.user %>
                <%= link_to 'Edit', edit_cafepost_path(cafepost), class: 'btn btn-success btn-sm' %>
                <%= link_to "Delete", cafepost, method: :delete, data: { confirm: "You sure?" }, class: 'btn btn-danger btn-sm' %>
              <% end %>
            </div>
          </div>
        </li>
      <% end %>
    </div>
  </div>
<% else %>
  <div class="center jumbotron">
    <div class="text-center">
      <h1>Welcome to the Cafe Navi</h1>
      <%= link_to 'Sign up now!', signup_path, class: 'btn btn-lg btn-primary' %>
    </div>
  </div>
<% end %>